---
export const prerender = false;

import StarlightPage from "@astrojs/starlight/components/StarlightPage.astro";
import type { Component } from "@studs/cms";
import Blocks from "../../components/Blocks.astro";
import { fetchDoc } from "../../_api/fetchDoc";
import PageTitle from "../../components/PageTitle.astro";
const { slug } = Astro.params;

let page: Component | null = null;

try {
    page = await fetchDoc<Component>({
      collection: 'components',
      slug,
      draft: false, // add in support for draft mode and previews
    })
    if(!page) {
      return Astro.redirect('/404')
    }
  } catch (error) {
    return Astro.redirect('/404')
  }

  const {title, description, version, component, component_status: status, category, figma_link: figma, usage, stories, guidelines} = page;

---

<StarlightPage frontmatter={{title}}>
  <PageTitle title={title }component={component} description={description} version={version} status={status} category={category} figma={figma} />
  <Blocks blocks={usage} />
</StarlightPage>